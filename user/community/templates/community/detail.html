<!DOCTYPE html>
<html>
<head>
    <title>게시글 상세보기</title>
    <script>
        function goBack() {
            const referrer = document.referrer;
            if (referrer.includes('/accounts/mypage/posts/')) {
                location.href = "{% url 'accounts:post_number' %}";
            } else if (referrer.includes('/accounts/mypage/scrap/post/')) {
                location.href = "{% url 'accounts:scrap_post' %}";
            } else if (referrer.includes('/community/list/')) {
                location.href = "{% url 'community:list' %}";
            } else {
                location.href = "{% url 'community:list' %}";  // 기본적으로 리스트 페이지로 이동
            }
        }
    </script>
</head>
<body>
    <button onclick="goBack()">뒤로가기</button><br><br>

    {{ author_nickname }} | {{ author_current_age_months }}
    <h2>{{ post.title }}</h2>
    {{ post.content }}<br><br>
    <!--댓글-->
    댓글 수: {{ post.answers.count }}<br><br>
    {% for answer in post.answers.all %}
        <b>{{ answer.author.profile.nickname }}</b><br>
        {{ answer.content }}   
        {%if request.user.is_authenticated %}
        <a href="{%url 'community:delete-answer' answer.id%}">삭제하기</a>
        {%endif%}
    {% empty %}
        댓글이 없습니다.
    {% endfor %}
    <br><br>

    <!--댓글 입력-->
    <form method="POST" action="{% url 'community:create-answer' post.id %}">
        {% csrf_token %}
        <input type="text" name="content" placeholder="댓글을 입력해주세요.">
        <input type="submit" value="등록">
    </form>
    <!--공감-->
    {% if request.user in post.like.all %}
    <form method="POST" action="{% url 'community:remove-like' post.id %}">
        {% csrf_token %}
        <button type="submit" name="like">공감 취소</button>   {{ post.like.count }}</form>
    {% else %}
    <form method="POST" action="{% url 'community:add-like' post.id %}">
        {% csrf_token %}
        <button type="submit" name="like">공감</button>   {{ post.like.count }}</form>
    {% endif %}
    <!--스크랩-->
    {% if request.user in post.scrap.all %}
    <form method="POST" action="{% url 'community:remove-scrap' post.id %}">
        {% csrf_token %}
        <button type="submit" name="scrap">스크랩 취소</button>   {{ post.scrap.count }}</form>
    {% else %}
    <form method="POST" action="{% url 'community:add-scrap' post.id %}">
        {% csrf_token %}
        <button type="submit" name="scrap">스크랩</button>   {{ post.scrap.count }}</form>
    {% endif %}
    <br>
    <!--게시글 삭제-->
    <a href="{%url 'community:delete' post.id %}">삭제하기</a>
</body>
</html>
